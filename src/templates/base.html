<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <title>Photo Organizer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Bootstrap 4 CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <!-- Bootstrap Treeview CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-treeview/1.2.0/bootstrap-treeview.min.css" />
    <!-- PhotoSwipe CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.css" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <!-- Custom styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}?v=8">
</head>
<body>
    <nav class="navbar navbar-expand-md">
        <a class="navbar-brand" href="{{ url_for('index') }}">
            <i class="fas fa-home"></i> Photos
        </a>
        <div class="navbar-right-group ml-auto d-flex align-items-center">
            <div class="zoom-controls">
                <button id="zoom-out" class="btn btn-outline-secondary btn-sm zoom-btn" title="Zoom out"><i class="fas fa-minus"></i></button>
                <button id="zoom-in" class="btn btn-outline-secondary btn-sm zoom-btn" title="Zoom in"><i class="fas fa-plus"></i></button>
            </div>
            <button class="btn btn-sm theme-toggle ml-1" id="theme-toggle" title="Toggle theme">
                <i class="fas fa-sun" id="theme-icon"></i>
            </button>
            <a class="btn btn-sm btn-outline-secondary ml-2" href="{{ url_for('admin_dashboard') }}">
                <i class="fas fa-cog"></i><span class="d-none d-sm-inline ml-1">Admin</span>
            </a>
        </div>
    </nav>

    <div class="container-fluid px-2 px-sm-3 mt-2" id="page-content">
        {% block content %}{% endblock %}
    </div>

    <!-- Floating scroll button -->
    <button class="scroll-fab" id="scroll-fab" title="Scroll to top">
        <i class="fas fa-arrow-up" id="scroll-fab-icon"></i>
    </button>

    <!-- Page loader overlay -->
    <div class="page-loader" id="page-loader">
        <div class="page-loader-content">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2 mb-0">Loading...</p>
        </div>
    </div>

    <!-- jQuery + Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <!-- Bootstrap Treeview -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-treeview/1.2.0/bootstrap-treeview.min.js"></script>
    <!-- PhotoSwipe JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

    {% block scripts %}{% endblock %}

    <script>
    (function() {
        var fab = document.getElementById('scroll-fab');
        var fabIcon = document.getElementById('scroll-fab-icon');

        function isAtTop() {
            return window.scrollY < 100;
        }

        function updateFab() {
            if (isAtTop()) {
                fabIcon.className = 'fas fa-arrow-down';
                fab.title = 'Scroll to bottom';
            } else {
                fabIcon.className = 'fas fa-arrow-up';
                fab.title = 'Scroll to top';
            }
        }

        fab.addEventListener('click', function() {
            if (isAtTop()) {
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            } else {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });

        window.addEventListener('scroll', updateFab, { passive: true });
        updateFab();
    })();
    </script>

    <script>
    (function() {
        const STORAGE_KEY = 'theme-preference';
        const toggle = document.getElementById('theme-toggle');
        const icon = document.getElementById('theme-icon');
        const html = document.documentElement;
        const modes = ['light', 'dark', 'midnight'];
        let current = localStorage.getItem(STORAGE_KEY) || 'light';

        function applyTheme(mode) {
            html.setAttribute('data-theme', mode);
            if (mode === 'light') {
                icon.className = 'fas fa-sun';
                toggle.title = 'Theme: Light';
            } else if (mode === 'dark') {
                icon.className = 'fas fa-moon';
                toggle.title = 'Theme: Dark';
            } else {
                icon.className = 'fas fa-star';
                toggle.title = 'Theme: Midnight';
            }
            localStorage.setItem(STORAGE_KEY, mode);
            current = mode;
        }

        toggle.addEventListener('click', function() {
            const idx = (modes.indexOf(current) + 1) % modes.length;
            applyTheme(modes[idx]);
        });

        applyTheme(current);
    })();
    </script>

    <script>
    (function() {
        var STORAGE_KEY = 'page-zoom';
        var MIN_ZOOM = 1;
        var MAX_ZOOM = 4;
        var DEFAULT_ZOOM = 3;
        var ZOOM_SCALES = {1: 1.3, 2: 1.15, 3: 1.0, 4: 0.85};
        var zoom = parseInt(localStorage.getItem(STORAGE_KEY)) || DEFAULT_ZOOM;
        if (zoom < MIN_ZOOM || zoom > MAX_ZOOM) zoom = DEFAULT_ZOOM;

        function applyZoom(level) {
            zoom = Math.max(MIN_ZOOM, Math.min(MAX_ZOOM, level));
            localStorage.setItem(STORAGE_KEY, zoom);
            var content = document.getElementById('page-content');
            if (content) content.style.zoom = ZOOM_SCALES[zoom] || 1;
            document.querySelectorAll('.gallery-grid').forEach(function(grid) {
                grid.setAttribute('data-zoom', zoom);
            });
            document.getElementById('zoom-out').disabled = zoom >= MAX_ZOOM;
            document.getElementById('zoom-in').disabled = zoom <= MIN_ZOOM;
        }

        applyZoom(zoom);

        document.getElementById('zoom-in').addEventListener('click', function() { applyZoom(zoom - 1); });
        document.getElementById('zoom-out').addEventListener('click', function() { applyZoom(zoom + 1); });

        window.applyPageZoom = function() { applyZoom(zoom); };
    })();
    </script>
</body>
</html>
